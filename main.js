(()=>{var V=Object.create;var v=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var T=Object.getPrototypeOf,S=Object.prototype.hasOwnProperty;var A=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var U=(n,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of R(e))!S.call(n,i)&&i!==t&&v(n,i,{get:()=>e[i],enumerable:!(o=M(e,i))||o.enumerable});return n};var B=(n,e,t)=>(t=n!=null?V(T(n)):{},U(e||!n||!n.__esModule?v(t,"default",{value:n,enumerable:!0}):t,n));var C=A((z,x)=>{"use strict";var O=0;function I(n,e){var t=e.data;if(!(!Array.isArray(t)||t.length<2)){var o=t[0],i=t[1],r=t[2],s=n._callbacks[o];!s||(delete n._callbacks[o],s(i,r))}}function b(n){var e=this;e._worker=n,e._callbacks={},n.addEventListener("message",function(t){I(e,t)})}b.prototype.postMessage=function(n){var e=this,t=O++,o=[t,n];return new Promise(function(i,r){if(e._callbacks[t]=function(a,c){if(a)return r(new Error(a.message));i(c)},typeof e._worker.controller<"u"){var s=new MessageChannel;s.port1.onmessage=function(a){I(e,a)},e._worker.controller.postMessage(o,[s.port2])}else e._worker.postMessage(o)})};x.exports=b});function _(n){return new Promise((e,t)=>{setTimeout(e,n)})}function l(){return[window.scrollX+visualViewport.offsetLeft,window.scrollY+visualViewport.offsetTop,window.scrollX+visualViewport.offsetLeft+visualViewport.width,window.scrollY+visualViewport.offsetTop+visualViewport.height]}function w(n){let e=l();return e[1]-=n*visualViewport.height,e[3]+=n*visualViewport.height,e}function y(n,e,t,o){var i=0,r=!1;return async s=>{let a=++i;r||(r=!0,n&&console.log(`--Action: Begin ${n}--`),t&&t()),await _(e),i==a&&(r=!1,o&&o(),n&&console.log(`--Action: End   ${n}--`))}}function P(n){window.scrollTo({behavior:n?.behavior,left:n?.left-window.visualViewport.offsetLeft,top:n?.top-window.visualViewport.offsetTop})}var d=class{doc;page_y0;page_y1;constructor(e,t){this.doc=t,this.page_y0=new Uint32Array(t.doc_pages+1),this.page_y1=new Uint32Array(t.doc_pages+1);for(var o=1;o<=t.doc_pages;o++)this.page_y0[o]=this.page_y1[o-1]+e,this.page_y1[o]=this.page_y0[o]+t.page_height[o]}getPage(e){let[t,o]=e,i=this.page_y0.findIndex(r=>r>=o);return Math.max(1,i)}getPageRange(e){let[t,o,i,r]=e,s=this.page_y1.findIndex(h=>h>=o),a=this.page_y0.findIndex(h=>h>=r),c=Math.max(1,s),E=a!=-1?a-1:this.doc.doc_pages;return[c,E]}setContainerCSS(e){e.style.height=`${this.page_y1[this.page_y1.length-1]}px`}setPageCSS(e,t,o){e.className="PDFPageContainer",t.className="PDFPageImage",e.style.top=`${this.page_y0[o]}px`,e.style.left="0px",e.style.height=`${this.doc.page_height[o]}px`,t.style.width=`${this.doc.page_width[o]}px`,t.style.height=`${this.doc.page_height[o]}px`}scrollTo(e,t,o){P({left:t,top:this.page_y0[e+1]+o})}};var L=B(C()),f=class{mu_worker;mu_openDocumentFromBuffer=e=>this.mu_worker.postMessage(["openDocumentFromBuffer",[e]]);mu_documentTitle=()=>this.mu_worker.postMessage(["documentTitle",[]]);mu_countPages=()=>this.mu_worker.postMessage(["countPages",[]]);mu_pageWidth=e=>this.mu_worker.postMessage(["pageWidth",[e]]);mu_pageHeight=e=>this.mu_worker.postMessage(["pageHeight",[e]]);mu_loadOutline=()=>this.mu_worker.postMessage(["loadOutline",[]]);mu_drawPageAsSVG=(e,t)=>this.mu_worker.postMessage(["drawPageAsSVG",[e,t]]);async loadModule(){let e=new Worker("worker.js");this.mu_worker=new L.default(e),console.log("--Mu: Module Loaded")}},m=class extends f{pageinfo;renderer;interact;async init(e,t){await this.loadModule(),await this.mu_openDocumentFromBuffer(e),console.log("--Mu: Document Loaded"),await this.initPages(t),await this.initRenderer(),await this.initInteract(),console.log("--Mu: Component Loaded")}async initPages(e){let t=await this.mu_countPages(),o=new Uint32Array(t+1),i=new Uint32Array(t+1);var r=await this.mu_documentTitle();r==""&&(r=e);for(var s=1;s<=t;s++){let a=await this.mu_pageWidth(s),c=await this.mu_pageHeight(s);o[s]=a,i[s]=c}this.pageinfo={doc_title:r,doc_pages:t,page_width:o,page_height:i}}async initRenderer(){this.renderer={renderSVG:async e=>await this.mu_drawPageAsSVG(e,0)}}async initInteract(){this.interact={getOutline:async()=>({title:this.pageinfo.doc_title,page:0,x:0,y:0,children:JSON.parse(await this.mu_loadOutline())})}}};var g=class extends Map{trim(e,t,o){if(this.size>e)for(let[i,r]of this.entries())t(i)||(this.delete(i),o(r))}getOrSet(e,t){if(this.has(e))return this.get(e);{let o=t();return this.set(e,o),o}}};var F=12,p=class{doc_page;doc_render;viewer_layout;viewer_div=document.createElement("div");viewer_pages=new g;async init(e,t){this.viewer_layout=t,this.viewer_div.style.setProperty("--image-quality","auto"),this.doc_page=e.pageinfo,this.doc_render=e.renderer,t.setContainerCSS(this.viewer_div),document.body.appendChild(this.viewer_div),document.title=this.doc_page.doc_title;let o=this.viewer_layout.getPageRange(w(2));this.viewUpdateEarly(o);let i=()=>this.onScrollIng(),r=y("scroll",160,null,()=>this.onScrollEnd());window.addEventListener("scroll",i),window.addEventListener("scroll",r),visualViewport.addEventListener("scroll",i),visualViewport.addEventListener("scroll",r)}pageAdd(e){let t={img:document.createElement("div"),div:document.createElement("div"),pn:e},o=t.img,i=t.div;return this.viewer_pages.set(e,t),this.viewer_layout.setPageCSS(i,o,e),this.viewer_div.appendChild(i),i.appendChild(o),t}pageRemove(e){let{div:t,img:o}=e;console.log(`Removing ${e.pn}`),this.viewer_div.removeChild(t),t.removeChild(o),o.className=""}async pageDraw(e,t){e.img.innerHTML=await this.doc_render.renderSVG(e.pn,-1)}async viewUpdateEarly([e,t]){for(var o=e;o<=t;o++)if(!this.viewer_pages.has(o)){let i=this.pageAdd(o);await this.pageDraw(i,1)}this.viewer_pages.trim(F,i=>e<=i&&i<=t,i=>this.pageRemove(i))}async viewUpdateUrgent([e,t]){let o=[];e-1>=1&&o.push(e-1),t+1<=this.doc_page.doc_pages&&o.push(t+1);for(var i of o)if(!this.viewer_pages.has(i)){let r=this.pageAdd(i);await this.pageDraw(r,0)}}onScrollIng(){let e=this.viewer_layout.getPageRange(l());this.viewUpdateUrgent(e)}onScrollEnd(){let e=this.viewer_layout.getPageRange(w(3));this.viewUpdateEarly(e)}};var k=(n,e)=>{let t=document.createElement("span");if(t.innerHTML=n.title+"&#10;&#13;",t.addEventListener("click",o=>{e.scrollTo(n.page,n.x,n.y)}),n.children){let o=document.createElement("details"),i=document.createElement("summary");i.appendChild(t),o.appendChild(i);for(let r of n.children)o.appendChild(k(r,e));return o}else return t.className="MenuOutlineTitleSingle",t},u=class extends p{doc_interact;async init(e,t){await super.init(e,t),this.doc_interact=e.interact;let o=await this.doc_interact.getOutline(),i=k(o,this.viewer_layout),r=document.createElement("div");r.id="MenuOutline",r.appendChild(i),document.body.appendChild(r),document.addEventListener("keydown",s=>{let a=t.getPageRange(l())[0]-1;s.key=="n"?t.scrollTo(Math.min(a+1,e.pageinfo.doc_pages-1),0,0):s.key=="k"&&t.scrollTo(Math.max(a-1,0),0,0)})}};function D(){let n=document.createElement("div");document.body.appendChild(n);let e=document.createElement("input");return e.className="FileUploader",e.type="file",e.accept=".pdf",n.appendChild(e),new Promise((t,o)=>{"launchQueue"in window&&window.launchQueue.setConsumer(async i=>{let s=await i.files[0].getFile();document.body.removeChild(n),t([URL.createObjectURL(s),s.name])}),e.addEventListener("change",i=>{i.preventDefault();let r=e.files[0];document.body.removeChild(n),t([URL.createObjectURL(r),r.name])})})}"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js",{scope:"."});(async()=>{let[n,e]=await D(),t=new m;await t.init(n,e);let o=new d(25,t.pageinfo);new u().init(t,o)})();})();
