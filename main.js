(()=>{var k=Object.create;var v=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var T=Object.getPrototypeOf,S=Object.prototype.hasOwnProperty;var A=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var U=(i,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of M(e))!S.call(i,n)&&n!==t&&v(i,n,{get:()=>e[n],enumerable:!(o=R(e,n))||o.enumerable});return i};var B=(i,e,t)=>(t=i!=null?k(T(i)):{},U(e||!i||!i.__esModule?v(t,"default",{value:i,enumerable:!0}):t,i));var C=A((z,x)=>{"use strict";var O=0;function I(i,e){var t=e.data;if(!(!Array.isArray(t)||t.length<2)){var o=t[0],n=t[1],r=t[2],s=i._callbacks[o];!s||(delete i._callbacks[o],s(n,r))}}function b(i){var e=this;e._worker=i,e._callbacks={},i.addEventListener("message",function(t){I(e,t)})}b.prototype.postMessage=function(i){var e=this,t=O++,o=[t,i];return new Promise(function(n,r){if(e._callbacks[t]=function(a,u){if(a)return r(new Error(a.message));n(u)},typeof e._worker.controller<"u"){var s=new MessageChannel;s.port1.onmessage=function(a){I(e,a)},e._worker.controller.postMessage(o,[s.port2])}else e._worker.postMessage(o)})};x.exports=b});function y(i){return new Promise((e,t)=>{setTimeout(e,i)})}function c(){return[window.scrollX+visualViewport.offsetLeft,window.scrollY+visualViewport.offsetTop,window.scrollX+visualViewport.offsetLeft+visualViewport.width,window.scrollY+visualViewport.offsetTop+visualViewport.height]}function w(i){let e=c();return e[1]-=i*visualViewport.height,e[3]+=i*visualViewport.height,e}function _(i,e,t,o){var n=0,r=!1;return async s=>{let a=++n;r||(r=!0,i&&console.log(`--Action: Begin ${i}--`),t&&t()),await y(e),n==a&&(r=!1,o&&o(),i&&console.log(`--Action: End   ${i}--`))}}function P(i){window.scrollTo({behavior:i?.behavior,left:i?.left-window.visualViewport.offsetLeft,top:i?.top-window.visualViewport.offsetTop})}var l=class{doc;page_y0;page_y1;constructor(e,t){this.doc=t,this.page_y0=new Uint32Array(t.doc_pages+1),this.page_y1=new Uint32Array(t.doc_pages+1);for(var o=1;o<=t.doc_pages;o++)this.page_y0[o]=this.page_y1[o-1]+e,this.page_y1[o]=this.page_y0[o]+t.page_height[o]}getPage(e){let[t,o]=e,n=this.page_y0.findIndex(r=>r>=o);return Math.max(1,n)}getPageRange(e){let[t,o,n,r]=e,s=this.page_y1.findIndex(h=>h>=o),a=this.page_y0.findIndex(h=>h>=r),u=Math.max(1,s),V=a!=-1?a-1:this.doc.doc_pages;return[u,V]}setContainerCSS(e){e.style.height=`${this.page_y1[this.page_y1.length-1]}px`}setPageCSS(e,t,o){e.className="PDFPageContainer",t.className="PDFPageImage",e.style.top=`${this.page_y0[o]}px`,e.style.left="0px",e.style.height=`${this.doc.page_height[o]}px`,t.style.width=`${this.doc.page_width[o]}px`,t.style.height=`${this.doc.page_height[o]}px`}scrollTo(e,t,o){P({left:t,top:this.page_y0[e+1]+o})}};var L=B(C()),f=class{mu_worker;mu_openDocumentFromBuffer=e=>this.mu_worker.postMessage(["openDocumentFromBuffer",[e]]);mu_documentTitle=()=>this.mu_worker.postMessage(["documentTitle",[]]);mu_pageWidthHeight=()=>this.mu_worker.postMessage(["pageWeightHeight",[]]);mu_loadOutline=()=>this.mu_worker.postMessage(["loadOutline",[]]);mu_drawPageAsSVG=(e,t)=>this.mu_worker.postMessage(["drawPageAsSVG",[e,t]]);async loadModule(){let e=new Worker("worker.js");this.mu_worker=new L.default(e),console.log("--Mu: Module Loaded")}},d=class extends f{pageinfo;renderer;interact;async init(e,t){await this.loadModule(),await this.mu_openDocumentFromBuffer(e),console.log("--Mu: Document Loaded"),await this.initPages(t),await this.initRenderer(),await this.initInteract(),console.log("--Mu: Component Loaded")}async initPages(e){let[t,o,n]=await this.mu_pageWidthHeight();var r=await this.mu_documentTitle();r==""&&(r=e),this.pageinfo={doc_title:r,doc_pages:t,page_width:o,page_height:n}}async initRenderer(){this.renderer={renderSVG:async e=>await this.mu_drawPageAsSVG(e,0)}}async initInteract(){this.interact={getOutline:async()=>({title:this.pageinfo.doc_title,page:0,x:0,y:0,children:JSON.parse(await this.mu_loadOutline())})}}};var g=class extends Map{trim(e,t,o){if(this.size>e)for(let[n,r]of this.entries())t(n)||(this.delete(n),o(r))}getOrSet(e,t){if(this.has(e))return this.get(e);{let o=t();return this.set(e,o),o}}};var F=12,m=class{doc_page;doc_render;viewer_layout;viewer_div=document.createElement("div");viewer_pages=new g;async init(e,t){this.viewer_layout=t,this.viewer_div.style.setProperty("--image-quality","auto"),this.doc_page=e.pageinfo,this.doc_render=e.renderer,t.setContainerCSS(this.viewer_div),document.body.appendChild(this.viewer_div),document.title=this.doc_page.doc_title;let o=this.viewer_layout.getPageRange(w(2));this.viewUpdateEarly(o);let n=()=>this.onScrollIng(),r=_("scroll",160,null,()=>this.onScrollEnd());window.addEventListener("scroll",n),window.addEventListener("scroll",r),visualViewport.addEventListener("scroll",n),visualViewport.addEventListener("scroll",r)}pageAdd(e){let t={img:document.createElement("div"),div:document.createElement("div"),pn:e},o=t.img,n=t.div;return this.viewer_pages.set(e,t),this.viewer_layout.setPageCSS(n,o,e),this.viewer_div.appendChild(n),n.appendChild(o),t}pageRemove(e){let{div:t,img:o}=e;console.log(`Removing ${e.pn}`),this.viewer_div.removeChild(t),t.removeChild(o),o.className=""}async pageDraw(e,t){e.img.innerHTML=await this.doc_render.renderSVG(e.pn,-1)}async viewUpdateEarly([e,t]){for(var o=e;o<=t;o++)if(!this.viewer_pages.has(o)){let n=this.pageAdd(o);await this.pageDraw(n,1)}this.viewer_pages.trim(F,n=>e<=n&&n<=t,n=>this.pageRemove(n))}async viewUpdateUrgent([e,t]){let o=[];e-1>=1&&o.push(e-1),t+1<=this.doc_page.doc_pages&&o.push(t+1);for(var n of o)if(!this.viewer_pages.has(n)){let r=this.pageAdd(n);await this.pageDraw(r,0)}}onScrollIng(){let e=this.viewer_layout.getPageRange(c());this.viewUpdateUrgent(e)}onScrollEnd(){let e=this.viewer_layout.getPageRange(w(3));this.viewUpdateEarly(e)}};var D=(i,e)=>{let t=document.createElement("span");if(t.innerHTML=i.title+"&#10;&#13;",t.addEventListener("click",o=>{e.scrollTo(i.page,i.x,i.y)}),i.children){let o=document.createElement("details"),n=document.createElement("summary");n.appendChild(t),o.appendChild(n);for(let r of i.children)o.appendChild(D(r,e));return o}else return t.className="MenuOutlineTitleSingle",t},p=class extends m{doc_interact;async init(e,t){await super.init(e,t),this.doc_interact=e.interact;let o=await this.doc_interact.getOutline(),n=D(o,this.viewer_layout),r=document.createElement("div");r.id="MenuOutline",r.appendChild(n),document.body.appendChild(r),document.addEventListener("keydown",s=>{let a=t.getPageRange(c())[0]-1;s.key=="n"?t.scrollTo(Math.min(a+1,e.pageinfo.doc_pages-1),0,0):s.key=="k"&&t.scrollTo(Math.max(a-1,0),0,0)})}};function E(){let i=document.createElement("div");document.body.appendChild(i);let e=document.createElement("input");return e.className="FileUploader",e.type="file",e.accept=".pdf",i.appendChild(e),new Promise((t,o)=>{"launchQueue"in window&&window.launchQueue.setConsumer(async n=>{let s=await n.files[0].getFile();document.body.removeChild(i),t([URL.createObjectURL(s),s.name])}),e.addEventListener("change",n=>{n.preventDefault();let r=e.files[0];document.body.removeChild(i),t([URL.createObjectURL(r),r.name])})})}"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js",{scope:"."});(async()=>{let[i,e]=await E(),t=new d;await t.init(i,e);let o=new l(25,t.pageinfo);new p().init(t,o)})();})();
